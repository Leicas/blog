---
author: gbmhunter
date: 2014-11-13
description: "A tutorial on quaternions, including calculators to convert between quaternions, rotation matrices and axis-angle notations."
draft: false
lastmod: 2019-03-24
tags: [ "quaternion", "matrix", "rotation", "complex", "SLERP", "interpolation", "Euler", "angle", "RPY", "gimbal lock", "attitude", "orientation", "vector", "calculator", "conversion" ]
title: "Quaternions"
type: page
---

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Overview</h2>

<p>A quaternion (pronounced qwa-ter-ne-ion) is a object which contains four numbers. Arguably, the most useful quaternions is a subset of all quaternions, called <b>unit quaternions</b> (or <b>versors</b>), which can be used to describe a rotation in 3D space. This page focuses on these unit quaternions.</p>

<p>There are a number of different ways to describe rotations. These include:</p>

<ul>
    <li>Euler angles (roll, pitch, yaw)</li>
    <li>Rotation matrices</li>
    <li>Quaternions</li>
</ul>

<p>Quaternions do not suffer from the <b>gimbal lock</b> that Euler angles do. A quaternion describes a rotation from one coordinate system to another. When they are used purely to represent a rotation (e.g. no reference coordinate system specified), they are called <b>rotation quaternions</b>. They can also be used to describe an orientation, as long as a reference coordinate system is supplied (in which the quaternion specifies the orientation as a rotation from the reference coordinate system to the coordinate system of the rotated object). In this case they are called <b>orientation quaternions</b>.</p>

<h2>Representation</h2>

<p>The basic form of a quaternion is:</p>

<p>$$ \hat{q} = a + b\hat{i} + c\hat{j} + d\hat{k} $$</p>

<p>In software, quaternions are described with a vector in where \(w, x, y, z\) are used instead of \(a, b, c, d\):</p>

<p>$$ \hat{q} = \begin{bmatrix}w\\x\\y\\z\end{bmatrix} $$</p>

<p>The \(w\) represents the scalar part of the quaternions and the \(x, y, z\) represents the vector part. You may see a quaternion written with an \(r\) for the scalar part and a \(v\) for the vector part.</p>

<p>$$ \hat{q} = (r, v) $$</p>

<p>Unit quaternions (the most common and useful type) are quaternions in which the magnitude of the vector is 1 (i.e. a <b>unit vector</b>).</p>

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Rotating A Vector</h2>

<p>$$
P = [ 0, p_x, p_y, p_z ] \\
R = [ w, x, y, z ] \\
R' = [ w, -x, -y, -z ]
$$</p>

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Combining Rotations</h2>

<p>Rotations can be easily combined when using quaternions.</p>

<p>Given two quaternion rotations that are to be applied consecutively, \( R_A \) and then \( R_B \), the total rotation \( R_C \) is found with:</p>

<p>$$ R_C = R_B R_A $$</p>

<p>Remember that <b>quaternion multiplication is not associative</b>, so the ordering of \( R_A \) and \( R_B \) is important.</p>

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Some Useful Quaternions</h2>

<table>
    <thead>
        <tr>
            <th>Quaternion</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>$$ q = [1, 0, 0, 0] $$</td>
            <td>Identity quaternion, no rotation.</td>
        </tr>
        <tr>
            <td>$$ q = [0, 1, 0, 0] $$</td>
            <td>Rotation of 180 around X axis.</td>
        </tr>
        <tr>
            <td>$$ q = [0, 0, 1, 0] $$</td>
            <td>Rotation of 180 around Y axis.</td>
        </tr>
        <tr>
            <td>$$ q = [0, 0, 0, 1] $$</td>
            <td>Rotation of 180 around Z axis.</td>
        </tr>
        <tr>
            <td>$$ q = [\sqrt{0.5}, \sqrt{0.5}, 0, 0] $$</td>
            <td>Rotation of 90 around X axis.</td>
        </tr>
        <tr>
            <td>$$ q = [\sqrt{0.5}, 0, \sqrt{0.5}, 0] $$</td>
            <td>Rotation of 90 around Y axis.</td>
        </tr>
        <tr>
            <td>$$ q = [\sqrt{0.5}, 0, 0, \sqrt{0.5}] $$</td>
            <td>Rotation of 90 around Z axis.</td>
        </tr>
        <tr>
            <td>$$ q = [\sqrt{0.5}, -\sqrt{0.5}, 0, 0] $$</td>
            <td>Rotation of -90 around X axis.</td>
        </tr>
        <tr>
            <td>$$ q = [\sqrt{0.5}, 0, -\sqrt{0.5}, 0] $$</td>
            <td>Rotation of -90 around Y axis.</td>
        </tr>
        <tr>
            <td>$$ q = [\sqrt{0.5}, 0, 0, -\sqrt{0.5}] $$</td>
            <td>Rotation of -90 around Z axis.</td>
        </tr>
</table>

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Interpolation</h2>

<h3>SLERP</h3>

<p>SLERP is shorthand for <b>spherical linear interpolation</b>. It is commonly used with quaternions to produce a smooth rotation of a 3D body from one orientation to another.</p>

<p><a href="https://en.wikipedia.org/wiki/Slerp">https://en.wikipedia.org/wiki/Slerp</a> has some code examples in Python and C++ that perform SLERP on quaternions.</p>

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Conversion From Axis-Angle Form To Quaternion</h2>

<p>A rotation in axis-angle form:</p>

<p>$$ axis = \begin{bmatrix}a_x\\a_y\\a_z\end{bmatrix} angle = \theta $$</p>

<p>can be converted into a quaternion with:</p>

<p>$$ \mathbf{q} = \begin{bmatrix}q_w\\q_x\\q_y\\q_z\end{bmatrix} = \begin{bmatrix} 
    \cos{\frac{\theta}{2}} \\
    a_x \sin{\frac{\theta}{2}} \\
    a_y \sin{\frac{\theta}{2}} \\
    a_z \sin{\frac{\theta}{2}} \\
    \end{bmatrix} $$</p>

<p>Use this tool to convert from a rotation expressed as an axis-angle to a quaternion:</p>

{{< calculators/axis-angle-to-quaternion >}}

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Conversion From Quaternion To Rotation Matrix</h2>

<p>If you have a quaternion in the form:</p>

<p>$$ \mathbf{q} = \begin{bmatrix}q_w\\q_x\\q_y\\q_z\end{bmatrix} $$</p>

<p>Then the equivalent rotation matrix is:</p>

<p>$$ \mathbf{R} = 
\begin{bmatrix}
1 - 2q_y^2 - 2q_z^2     & 2q_xq_y - 2q_zq_w    & 2q_xq_z + 2q_yq_w \\
2q_xq_y + 2q_zq_w       & 1 - 2q_x^2 - 2q_z^2  & 2q_yq_z - 2q_xq_w \\
2q_xq_z - 2q_yq_w       & 2q_yq_z + 2q_xq_w    & 1 - 2q_x^2 - 2q_y^2
\end{bmatrix}
$$</p>

<p>Use this tool to convert quaternions to rotation matrices.</p>

{{< calculators/quaternion-to-rotation-matrix >}}



