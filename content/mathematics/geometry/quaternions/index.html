---
author: gbmhunter
categories: [ "Mathematics", "Geometry" ]
date: 2014-11-13
description: "A tutorial on quaternions, including calculators to convert between quaternions, rotation matrices and axis-angle notations."
draft: false
lastmod: 2019-03-24
tags: [ "quaternion", "matrix", "rotation", "complex", "SLERP", "interpolation", "Euler", "angle", "RPY", "gimbal lock", "attitude", "orientation", "vector", "calculator", "conversion" ]
title: "Quaternions"
type: page
---

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Overview</h2>

<p>A quaternion (pronounced qwa-ter-ne-ion) is a object which contains four numbers. Arguably, the most useful quaternions is a subset of all quaternions, called <b>unit quaternions</b> (or <b>versors</b>), which can be used to describe a rotation in 3D space. This page focuses on these unit quaternions.</p>

<p>There are a number of different ways to describe rotations. These include:</p>

<ul>
    <li>Euler angles (roll, pitch, yaw)</li>
    <li>Rotation matrices</li>
    <li>Quaternions</li>
</ul>

<p>Quaternions do not suffer from the <b>gimbal lock</b> that Euler angles do. A quaternion describes a rotation from one coordinate system to another. When they are used purely to represent a rotation (e.g. no reference coordinate system specified), they are called <b>rotation quaternions</b>. They can also be used to describe an orientation, as long as a reference coordinate system is supplied (in which the quaternion specifies the orientation as a rotation from the reference coordinate system to the coordinate system of the rotated object). In this case they are called <b>orientation quaternions</b>.</p>

<h2>Representation</h2>

<p>The basic form of a quaternion is:</p>

<p>$$ \mathbf{q} = w + x\mathbf{i} + y\mathbf{j} + z\mathbf{k} $$</p>

<p>in where the multiplication rules are:</p>

<p>$$ \mathbf{i}^2 = \mathbf{j}^2 = \mathbf{k}^2 = \mathbf{ijk} = -1 $$</p>

<p>In software, quaternions are described with a vector in where \(w, x, y, z\) are the coefficients of \(mathbf{i,j,k}\):</p>

<p>$$ \mathbf{q} = \begin{bmatrix}w\\x\\y\\z\end{bmatrix} $$</p>

<p>The \(w\) represents the scalar part of the quaternions and the \(x, y, z\) represents the vector part. You may see a quaternion written with an \(r\) for the scalar part and a \(v\) for the vector part.</p>

<p>$$ \mathbf{q} = (r, v) $$</p>

<p>Unit quaternions (the most common and useful type) are quaternions in which the magnitude of the vector is 1 (i.e. a <b>unit vector</b>). This is when:</p>

<p>$$ w^2 + x^2 + y^2 + z^2 = 1 $$</p>

<p>All quaternions have a conjugate. The conjugate is:</p>

<p>$$ \mathbf{\bar{q}} = w - x\mathbf{i} - y\mathbf{j} - z\mathbf{k} $$</p>

<p>A pure quaternion is a quaternion where \(w=0\). This results in a quaternion:</p>

<p>$$ \mathbf{q} = x\mathbf{i} + y\mathbf{j} + z\mathbf{k} $$</p>

<p>This also happens to represent a vector in 3D space.</p>

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Rotating A Vector</h2>

<p>You can rotate a vector \(v\) in 3D space to \(v'\) with:</p>

<p>$$ v' = qvq' $$</p>

<p>using the <i>Hamilton product</i>.</p>

<p>Lets assume we have the vector:</p>

<p>$$ v = \begin{bmatrix}1\\0\\0\end{bmatrix} $$</p>

<p>And we want to rotate it with the quaternion:</p>

<p>$$ q = \begin{bmatrix}\sqrt{0.5} \\ 0 \\ \sqrt{0.5} \\ 0]\end{bmatrix} $$</p>

<p>This quaternion just so happens to be a rotation of \(90\) around the y-axis.</p>

<p>Combine into:</p>

<p>$$
  v' = 
  \begin{bmatrix}\sqrt{0.5} \\ 0 \\ \sqrt{0.5} \\ 0]\end{bmatrix}
  \begin{bmatrix}0\\1\\0\\0\end{bmatrix}
  \begin{bmatrix}\sqrt{0.5} \\ 0 \\ -\sqrt{0.5} \\ 0]\end{bmatrix}
$$</p>

<p>To calculate the multiplication of two quaternions, you can use the Hamilton product. If you have the equation:</p>

<p>$$q3 = q1*q2$$</p>

<p>where each quaternion is composed in the following manner:</p>

<p>$$ q1 = q1_w + q1_x \mathbf{i} + q1_y \mathbf{y} + q1_z \mathbf{z} $$</p>

<p>then using the Hamilton product, the values of each component in \(q3\) are<a href="#1"><sup>1</sup></a>:</p>

<p> 
$$
  q3_w = q1_w q2_w - q1_x q2_x - q1_y q2_y - q1_z q2_z \\
  q3_x = q1_x q2_w + q1_w q2_x - q1_z q2_y + q1_y q2_z \\
  q3_y = q1_y q2_w + q1_z q2_x + q1_w q2_y - q1_x q2_z \\
  q3_x = q1_z q2_w - q1_y q2_x + q1_x q2_y + q1_w q2_z
$$</p>

<!-- ###################################################################### -->
<!-- ROTATION MATRIX                                                        -->
<!-- ###################################################################### -->
<h2>Rotation Matrix</h2>

<p>You can calculate a 3x3 rotation matrix from a quaternion. This is useful if you want to express the rotation as a matrix instead of a quaternion, but comes at the expense of having to store 9 numbers rather than 4!</p>

<!-- ###################################################################### -->
<!-- COMBINING ROTATIONS                                                    -->
<!-- ###################################################################### -->
<h2>Combining Rotations</h2>

<p>Rotations can be easily combined when using quaternions.</p>

<p>Given two quaternion rotations that are to be applied consecutively, \( R_A \) and then \( R_B \), the total rotation \( R_C \) is found with:</p>

<p>$$ R_C = R_B R_A $$</p>

<p>Remember that <b>quaternion multiplication is not associative</b>, so the ordering of \( R_A \) and \( R_B \) is important.</p>

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Some Useful Quaternions</h2>

<table>
    <thead>
        <tr>
            <th>Quaternion</th>
            <th>Description</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>$$ \mathbf{q} = [1, 0, 0, 0] $$</td>
            <td>Identity quaternion, no rotation.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [0, 1, 0, 0] $$</td>
            <td>Rotation of 180 around X axis.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [0, 0, 1, 0] $$</td>
            <td>Rotation of 180 around Y axis.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [0, 0, 0, 1] $$</td>
            <td>Rotation of 180 around Z axis.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [\sqrt{0.5}, \sqrt{0.5}, 0, 0] $$</td>
            <td>Rotation of 90 around X axis.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [\sqrt{0.5}, 0, \sqrt{0.5}, 0] $$</td>
            <td>Rotation of 90 around Y axis.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [\sqrt{0.5}, 0, 0, \sqrt{0.5}] $$</td>
            <td>Rotation of 90 around Z axis.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [\sqrt{0.5}, -\sqrt{0.5}, 0, 0] $$</td>
            <td>Rotation of -90 around X axis.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [\sqrt{0.5}, 0, -\sqrt{0.5}, 0] $$</td>
            <td>Rotation of -90 around Y axis.</td>
        </tr>
        <tr>
            <td>$$ \mathbf{q} = [\sqrt{0.5}, 0, 0, -\sqrt{0.5}] $$</td>
            <td>Rotation of -90 around Z axis.</td>
        </tr>
</table>

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Interpolation</h2>

<h3>SLERP</h3>

<p>SLERP is shorthand for <b>spherical linear interpolation</b>. It is commonly used with quaternions to produce a smooth rotation of a 3D body from one orientation to another.</p>

<p><a href="https://en.wikipedia.org/wiki/Slerp">https://en.wikipedia.org/wiki/Slerp</a> has some code examples in Python and C++ that perform SLERP on quaternions.</p>

<!-- ###################################################################### -->
<!-- CONVERSION -->
<!-- ###################################################################### -->
<h2>Conversion From Axis-Angle Form To Quaternion</h2>

<p>A rotation in axis-angle form:</p>

<p>$$ axis = \begin{bmatrix}a_x\\a_y\\a_z\end{bmatrix} angle = \theta $$</p>

<p>can be converted into a quaternion with:</p>

<p>$$ \mathbf{q} = \begin{bmatrix}q_w\\q_x\\q_y\\q_z\end{bmatrix} = \begin{bmatrix} 
    \cos{\frac{\theta}{2}} \\
    a_x \sin{\frac{\theta}{2}} \\
    a_y \sin{\frac{\theta}{2}} \\
    a_z \sin{\frac{\theta}{2}} \\
    \end{bmatrix} $$</p>

<p>Use this tool to convert from a rotation expressed as an axis-angle to a quaternion:</p>

{{< calculators/axis-angle-to-quaternion >}}

<!-- ###################################################################### -->
<!-- ###################################################################### -->
<!-- ###################################################################### -->
<h2>Conversion From Quaternion To Rotation Matrix</h2>

<p>If you have a quaternion in the form:</p>

<p>$$ \mathbf{q} = \begin{bmatrix}q_w\\q_x\\q_y\\q_z\end{bmatrix} $$</p>

<p>Then the equivalent rotation matrix is:</p>

<p>$$ \mathbf{R} = 
\begin{bmatrix}
1 - 2q_y^2 - 2q_z^2     & 2q_xq_y - 2q_zq_w    & 2q_xq_z + 2q_yq_w \\
2q_xq_y + 2q_zq_w       & 1 - 2q_x^2 - 2q_z^2  & 2q_yq_z - 2q_xq_w \\
2q_xq_z - 2q_yq_w       & 2q_yq_z + 2q_xq_w    & 1 - 2q_x^2 - 2q_y^2
\end{bmatrix}
$$</p>

<p>Use this tool to convert quaternions to rotation matrices.</p>

{{< calculators/quaternion-to-rotation-matrix >}}


<a name="1">https://www.mathworks.com/help/aeroblks/quaternionmultiplication.html</a>
